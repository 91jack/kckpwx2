<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <title>输入协议书信息</title>
  <link rel="stylesheet" type="text/css" href="static/css/common.css"/>
 	<link rel="stylesheet" href="static/css/app.css" />
</head>
<body class="chooseaccident-page bg-f4">
	<!--顶部标题栏-->
	<div class="header-top">
		<div class="fl">
			<a href="javascript:;" class="goback">
				<em class="icon-goback"></em>
				<span class="goback-text">返回</span>
			</a>
		</div>
		<h2 class="header-top-title">输入协议书信息</h2>
	</div>
	
	
	<!--内容区图片区-->
	<div class="fix-duty-content">
		<div class="mymsg-content">
			<form class="form-type">
				<ul class="information bg-f">
					<li class="time">
						<span>事故时间</span>
						<em class="fulltime">2018-01-26  </em>
						<em class="detail-time">  11:08</em>
						<strong class="fr"></strong>
					</li>
					<li>
						<a href="map.html">
							<span>事故地点</span>
							<p class="adreess">重庆市渝北区金开大道</p>
							<strong class="fr"></strong>
						</a>
					</li>
					<li class="select-weather">
						<span>天气</span>
						<em>请选择</em>
						<strong class="fr"></strong>
					</li>
				</ul>
				<div class="form-type-group clearfix">
					<a href="chooseaccident.html">
						<em>事故形态</em>
						<p class="accidentInfo">在同车道行驶中，不按规定与前车保持必要的安全距离的（追尾）</p>
						<span></span>
					</a>
				</div>
			</form>
			
			<form class="form">
				<div class="form-group">
					<em>本方信息</em>
				</div>
				
				<div class="form-group">
					<span>姓名</span>
					<em class="fr">秦牧</em>
				</div>
				
				<div class="form-group">
					<span>号牌号码</span>
					<em class="fr">渝A2B440</em>
				</div>
				
				<div class="form-group">
					<span>手机号码</span>
					<em class="fr">18680745771</em>
				</div>
				
				<div class="form-group">
					<span>车损部位</span>
					<strong class="fr"></strong>
					<em class="fr cardestory" data-index="0">请选择</em>
				</div>
				<div class="form-group">
					<span>事故责任</span>
					<em class="fr">全责</em>
				</div>
				<div class="form-group">
					<span>保险公司</span>
					<span class="fr Insurance" id="ensu1" data-insuranceId=''>请选择(非必选)</span>
					<em class="fr"></em>
				</div>
				<div class="form-group">
					<span>保险单号</span>
					<input id="" placeholder="请输入保险单号（可空）" />
				</div>
				
			</form>
			
			<form class="form">
				<div class="form-group">
					<em>对方信息</em>
				</div>
				
				<div class="form-group">
					<span>姓名</span>
					<em class="fr">秦牧</em>
				</div>
				
				<div class="form-group">
					<span>号牌号码</span>
					<em class="fr">渝A2B440</em>
				</div>
				
				<div class="form-group">
					<span>手机号码</span>
					<em class="fr">18680745771</em>
				</div>
				
				<div class="form-group">
					<span>车损部位</span>
					<strong class="fr"></strong>
					<em class="fr cardestory" data-index="1">请选择</em>
				</div>
				<div class="form-group">
					<span>事故责任</span>
					<em class="fr active">无责</em>
				</div>
				<div class="form-group">
					<span>保险公司</span>
					<span class="fr Insurance" id="ensu2" data-insuranceId=''>请选择(非必选)</span>
					<em class="fr"></em>
				</div>
				<div class="form-group">
					<span>保险单号</span>
					<input id="" placeholder="请输入保险单号（可空）" />
				</div>
			</form>
		</div>
	</div>
	
	<!--选择事故模态框-->
	<div class="btn active">
		<a href="JavaScript:;">
			完成
		</a>
	</div>
	<div class="footer-cover"></div>

<script src="static/js/jquery-3.1.1.min.js"  type="text/javascript" charset="utf-8"></script>
<script src="static/js/picker.min.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/config.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/common.js"  type="text/javascript" charset="utf-8"></script>
<!--当前页面交互-->
<script type="text/javascript">
	
	if (localStorage.getItem('nowTime')) {
		$('.detail-time').html(localStorage.getItem('nowTime'))
	}
	if (localStorage.getItem('nowWeather')) {
		$('.select-weather em').html(localStorage.getItem('nowWeather')).css('color','#333')
	}
	$('.fulltime').html(accidentTime)
	$('.detail-time').html(nowTime)
	// 事故时间
		var hours = []
		for(var i=0;i<24;i++){
			var text = i<10 ? '0'+i : String(i)
			hours.push({value:i,text:text})
		}
		var min = []
		for(var i=0;i<60;i++){
			var text = i<10 ? '0'+i : String(i)
			min.push({value:i,text:text})
		}
		var timePicker = new Picker({
				data: [hours,min],
				selectedIndex: [h,minutes],// 定位到当前时间
				title:''
		});
		timePicker.on('picker.select', function (selectedVal, selectedIndex) {
			console.log(selectedVal)
			console.log(selectedIndex)
			var selectHour = hours[selectedIndex[0]].text;
			var selectMin = min[selectedIndex[1]].text;
			var time = selectHour + ':' +selectMin;
			$('.time .detail-time').text(time)
			localStorage.setItem('nowTime',time)
		})
		
		$('.time').on('click', function(){
			timePicker.show();
		})
		
		
		//天气
		var weatherPicker = new Picker({
			data: [weather],
			selectedIndex: [0],
			title:''
		});
		weatherPicker.on('picker.select', function (selectedVal, selectedIndex) {
			console.log(selectedVal)
				$('.select-weather em').text(weather[selectedIndex].text).css('color','#333')
				localStorage.setItem('nowWeather',weather[selectedIndex].text);
		})
		
		$('.select-weather').on('click', function(){
			weatherPicker.show();
		})
		// 保险公司
		$.ajax({
			type:"get",
			url: getInsuranceUrl,
			success: function(res){
				console.log(res)
				var Insurance = [];
				for(var i=0;i<res.list.length;i++){
					Insurance.push({'value': res.list[i].code,'text':res.list[i].name})
				}
				var InsurancePicker1 = new Picker({
					data: [Insurance],
					selectedIndex: [1],// 
					title:''
				});
				var InsurancePicker2 = new Picker({
					data: [Insurance],
					selectedIndex: [1],// 
					title:''
				});
				
				
				$('.Insurance').eq(0).on('click',function(){
					InsurancePicker1.show();
					InsurancePicker1.on('picker.select', function (selectedVal, selectedIndex) {
					var selectInsurance = Insurance[selectedIndex].text;
					$('.Insurance').eq(0).text(selectInsurance)
					$('.Insurance').eq(0).attr('data-insuranceId',selectedVal);
				})
					
				$('.Insurance').eq(1).on('click',function(){
					InsurancePicker2.show();
					InsurancePicker2.on('picker.select', function (selectedVal, selectedIndex) {
					var selectInsurance = Insurance[selectedIndex].text;
					$('.Insurance').eq(1).text(selectInsurance)
					$('.Insurance').eq(1).attr('data-insuranceId',selectedVal);
					})
				})
			});
		}
	})
		
	
	$(function(){
		// 车损部位选择
		$.ajax({
			type:"post",
			url:getAccidentDamageUrl,
			success:function(res){
				var AccidentDamage = [];
				for(var i=0;i<res.list.length;i++){
					AccidentDamage.push({'value': res.list[i].code,'text':res.list[i].name})
				}
				var AccidentDamagePicker1 = new Picker({
					data: [AccidentDamage],
					//selectedIndex: [1], 
					title:''
				});
				
				var AccidentDamagePicker2 = new Picker({
					data: [AccidentDamage],
					selectedIndex: [1], 
					title:''
				});


	
				$('.cardestory').eq(0).click(function(){
						AccidentDamagePicker1.show();
						AccidentDamagePicker1.on('picker.select', function (selectedVal, selectedIndex) {
						var selectCarDestory = AccidentDamage[selectedIndex].text;
						console.log(selectCarDestory)
						$('.cardestory').eq(0).text(selectCarDestory)
					})
				})
				
				$('.cardestory').eq(1).click(function(){
						AccidentDamagePicker2.show();
						AccidentDamagePicker2.on('picker.select', function (selectedVal, selectedIndex) {
						var selectCarDestory = AccidentDamage[selectedIndex].text;
						$('.cardestory').eq(1).text(selectCarDestory)
						$('.btn').removeClass('active');
					})
				})
			}
		})
	})
	
	
	$('.adreess').html(localStorage.getItem('addr'))

	// 
	$.ajax({
		type:"post",
		url:getAccidentUserInfoUrl,
		data:{
			token:token,
			accidentId:accidentId
		},
		success:function(data){
			console.log(data)
			if (data.status==2000) {
				var Len = data.list.length;
				for (var i=0;i<Len;i++) {
					// 事故责任判定
					if(data.list[i].dutycode == 5){
						$('.mymsg-content .form').eq(i).children('.form-group').eq(5).children('em').css('background','#F43C3C');
					}else if(data.list[i].dutycode == 1){
						$('.mymsg-content .form').eq(i).children('.form-group').eq(5).children('em').css('background','#38ADFF');
					}
					
					if(data.list[i].type == 1){
						$('.mymsg-content .form').eq(0).children('.form-group').eq(1).children('em').html(data.list[i].name);
						$('.mymsg-content .form').eq(0).children('.form-group').eq(2).children('em').html(data.list[i].carno);
						$('.mymsg-content .form').eq(0).children('.form-group').eq(3).children('em').html(data.list[i].phone);
						$('.mymsg-content .form').eq(0).children('.form-group').eq(5).children('em').html(data.list[i].dutyname);
						
						if(data.list[i].dutycode == 1){
							$('.mymsg-content .form').eq(0).children('.form-group').eq(5).children('em').css('background','#F43C3C');
						}else{
							$('.mymsg-content .form').eq(0).children('.form-group').eq(5).children('em').css('background','#38ADFF');
						}
						
						
					}else{
						$('.mymsg-content .form').eq(1).children('.form-group').eq(1).children('em').html(data.list[i].name);
						$('.mymsg-content .form').eq(1).children('.form-group').eq(2).children('em').html(data.list[i].carno);
						$('.mymsg-content .form').eq(1).children('.form-group').eq(3).children('em').html(data.list[i].phone);
						$('.mymsg-content .form').eq(1).children('.form-group').eq(5).children('em').html(data.list[i].dutyname);
						if(data.list[i].dutycode == 1){
							$('.mymsg-content .form').eq(1).children('.form-group').eq(5).children('em').css('background','#F43C3C');
						}else{
							$('.mymsg-content .form').eq(1).children('.form-group').eq(5).children('em').css('background','#38ADFF');
						}
					}
				}
				

				
				$('.btn').click(function(){
					var on = !$('.btn').hasClass('active');
					if (on) {
						console.log(1111)
						var user = [
							{'id': data.list[1].id,'damagecode': '01','dutycode': data.list[1].dutycode,'insurerId':$('#ensu1').attr('data-insuranceId')},
							{'id': data.list[0].id,'damagecode': '02','dutycode': data.list[0].dutycode,'insurerId':$('#ensu2').attr('data-insuranceId')}
						]
						var datetime = $('.fulltime').html()+' '+$('.detail-time').html();
						console.log(datetime)
						user = JSON.stringify(user)
						console.log(user)
						$.ajax({
							type:"post",
							url: choseAccidentDutyUrl,
							data: {
								token: token,
								accidentId:accidentId,
								user: user,
								isExpressway:'',
								weather:$('.select-weather em').html(),
								address:$('.adreess').html(),
								address_xy:localStorage.getItem('address_xy'),
								datetime:datetime
							},
							dataType: "json",
							success: function(res){
								console.log(res)
								if(res.status == 2000){
									window.location.href = 'msg_certification.html'
								}
							}
						});
					}
				})
			}
		}
	});
	
//获取事故情形
//	var dataInfo = localStorage.getItem('detailinfo');
//	$('.accidentInfo').html(dataInfo);
	$.ajax({
		type:"post",
		url:getAccidentInfoUrl,
		data:{
			token:token,
			accidentId:accidentId
		},
		success:function(data){
			console.log(data);
			if (data.status==2000) {
				$('.accidentInfo').html(data.pagination.viewname)
			}
		}
	});
	
</script>

</body>
</html>