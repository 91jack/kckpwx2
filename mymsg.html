<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <title>输入证件信息</title>
  <link rel="stylesheet" type="text/css" href="static/css/common.css"/>
 	<link rel="stylesheet" href="static/css/app.css" />
</head>
<body class="mymsg-page bg-f4">
	<!--顶部标题栏-->
	<div class="header-top">
		<div class="fl">
			<a href="javascript:;" class="goback">
				<em class="icon-goback"></em>
				<span class="goback-text">返回</span>
			</a>
		</div>
		<h2 class="header-top-title">输入证件信息</h2>
	</div>


	<!--内容区-->
	<div class="mymsg-content">
		<form class="form myform">
			<div class="form-group">
				<em>本方信息</em>
			</div>

			<div class="form-group">
				<span>姓名</span>
				<input type="text" placeholder="请输入姓名" class="fl name"/>
				<a href="javascript:;" class="yzm-btn mydrive"></a>
			</div>

			<div class="form-group">
				<span>身份证号码</span>
				<strong></strong>
				<input type="text" placeholder="请输入身份证号码" class="idcard" maxlength="18"/>
			</div>

			<div class="form-group">
				<span>手机号码</span>
				<strong></strong>
				<input type="text" placeholder="请输入手机号码" class="phone" maxlength="11"/>
			</div>

			<div class="form-group">
				<span>车牌号码</span>
				<strong></strong>
				<input type="text" placeholder="车牌号(渝A**666)" class="fl cpcode" maxlength="8"/>
				<a href="javascript:;" class="yzm-btn mycar" data="11"></a>
			</div>
			<div class="form-group">
				<span>号牌种类</span>
				<span class="fr cartype1" data-cartypeId='1'>小型汽车</span>
				<em class="fr"></em>
			</div>

		</form>
		
		<form class="form otherform">
			<div class="form-group">
				<em>对方信息</em>
			</div>

			<div class="form-group">
				<span>姓名</span>
				<input type="text" placeholder="请输入姓名" class="fl name1"/>
				<a href="javascript:;" class="yzm-btn mydrive"></a>
			</div>

			<div class="form-group">
				<span>身份证号码</span>
				<strong></strong>
				<input type="text" placeholder="请输入身份证号码" class="idcard1" maxlength="18"/>
			</div>

			<div class="form-group">
				<span>手机号码</span>
				<strong></strong>
				<input type="text" placeholder="请输入手机号码" class="phone1" maxlength="11"/>
			</div>

			<div class="form-group">
				<span>车牌号码</span>
				<strong></strong>
				<input type="text" placeholder="车牌号(渝A**666)" class="fl cpcode1" maxlength="8"/>
				<a href="javascript:;" class="yzm-btn mycar" data="22"></a>
			</div>
			<div class="form-group">
				<span>号牌种类</span>
				<span class="fr cartype2" data-cartypeId='1'>小型汽车</span>
				<em class="fr"></em>
			</div>

		</form>
	</div>


	<!--下一步-->
	<div class="btn active">
		<a href="javascript:;">
			下一步
		</a>
	</div>
	<!--确认信息模态框-->
	<div class="msg-modal total">
		<div class="modal-content">
			<p>本方信息确认</p>
			<ul>
			</ul>
			<div class="modal-btn clearfix">
				<a href="javascript:;">
					取消
				</a>
				<a href="javascript:;">
					确定
				</a>
			</div>
		</div>
	</div>
	
	<!--信息不对的弹框-->
	
	<div class="alert">
		<div class="alert-cont bg-f">
			<div class="msg">
				请输入正确的身份证明号码,手机号码及车牌号
			</div>
			<p class="sue">确认</p>
		</div>
	</div>
	
	<!--绑定驾驶证模态框-->
	<div class="msg-modal drive" id="bind-drive1">
		<div class="modal-content">
			<p>拍摄本方的驾驶证</p>
			<span>拍摄自己的驾驶证,自动识别信息!</span>
			<div class="msg-img">
				<img id="picdrive" data='1' src="static/images/common/card_driver.png"/>
				<div class="loading-cover"><div class="cover-cont"></div><p>图片上传中</p></div>
				<div class="camera">
					<input id="drivecards" type="file"/>
				</div>
			</div>
			<div class="modal-btn clearfix">
				<a href="javascript:;">
					取消
				</a>
				<a href="javascript:;">
					确定
				</a>
			</div>
		</div>
	</div>
	
	<div class="msg-modal drive" id="bind-drive2">
		<div class="modal-content">
			<p>拍摄本方的驾驶证</p>
			<span>拍摄自己的驾驶证,自动识别信息!</span>
			<div class="msg-img">
				<img id="picdrive1" data='1' src="static/images/common/card_driver.png"/>
				<div class="loading-cover"><div class="cover-cont"></div><p>图片上传中</p></div>
				<div class="camera">
					<input id="drivecards1" type="file"/>
				</div>
			</div>
			<div class="modal-btn clearfix">
				<a href="javascript:;">
					取消
				</a>
				<a href="javascript:;">
					确定
				</a>
			</div>
		</div>
	</div>

	<!--绑定行驶证-->
	<div class="msg-modal drive" id="bind-car1">
		<div class="modal-content">
			<p>拍摄本方的行驶证</p>
			<span>拍摄自己的行驶证,自动识别信息!</span>
			<div class="msg-img">
				<img id="picrun" data='2' src="static/images/common/card_xingshizheng.png"/>
				<div class="loading-cover"><div class="cover-cont"></div><p>图片上传中</p></div>
				<div class="camera">
					<input id="carcards" type="file"/>
				</div>
			</div>
			<div class="modal-btn clearfix">
				<a href="javascript:;">
					取消
				</a>
				<a href="javascript:;">
					确定
				</a>
			</div>
		</div>
	</div>
	
	<div class="msg-modal drive" id="bind-car2">
		<div class="modal-content">
			<p>拍摄本方的行驶证</p>
			<span>拍摄自己的行驶证,自动识别信息!</span>
			<div class="msg-img">
				<img id="picrun1" data='2' src="static/images/common/card_xingshizheng.png"/>
				<div class="loading-cover"><div class="cover-cont"></div><p>图片上传中</p></div>
				<div class="camera">
					<input id="carcards1" type="file"/>
				</div>
			</div>
			<div class="modal-btn clearfix">
				<a href="javascript:;">
					取消
				</a>
				<a href="javascript:;">
					确定
				</a>
			</div>
		</div>
	</div>
	
	<div class="upload-error">图片识别失败</div>
	

<script src="static/js/jquery-3.1.1.min.js"  type="text/javascript" charset="utf-8"></script>
<script src="static/js/picker.min.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/config.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/common.js"  type="text/javascript" charset="utf-8"></script>
<!--当前页面交互-->
<script type="text/javascript">

	if (localStorage.getItem('mine')||localStorage.getItem('yours')) {
		var mineData = JSON.parse(localStorage.getItem('mine'))
		var yoursData = JSON.parse(localStorage.getItem('yours'))
		$('.name').val(mineData.name);
		$('.idcard').val(mineData.cardNo);
		$('.phone').val(mineData.phone);
		$('.cpcode').val(mineData.carNo);
		$('.cartype1').attr('data-cartypeId',mineData.cartype);
		$('.cartype1').html(localStorage.getItem('cartype1'));
		$('#picdrive').attr('src',mineData.firstpic);
		$('#picrun').attr('src',mineData.secondpic);
		$('.name1').val(yoursData.name);
		$('.idcard1').val(yoursData.cardNo);
		$('.phone1').val(yoursData.phone);
		$('.cpcode1').val(yoursData.carNo);
		$('.cartype2').attr('data-cartypeId',yoursData.cartype);
		$('.cartype2').html(localStorage.getItem('cartype2'));
		$('#picdrive1').attr('src',yoursData.firstpic);
		$('#picrun1').attr('src',yoursData.secondpic);
		$('.alert').hide();
		active();
	}




	// 号牌种类

	$(function(){
		$.ajax({
			type:"get",
			url: getCarTypeUrl,
			success: function(res){
				//console.log(res)
				var carType = [];
				for(var i=0;i<res.list.length;i++){
					carType.push({'value': res.list[i].code,'text':res.list[i].name})
				}
				var cartypePicker1 = new Picker({
					data: [carType],
					selectedIndex: [1],// 
					title:''
				});
				
				var cartypePicker2 = new Picker({
					data: [carType],
					selectedIndex: [1],// 
					title:''
				});
				
				$('.cartype1').on('click',function(){
					var that = $(this)
					cartypePicker1.show();
					cartypePicker1.on('picker.select', function (selectedVal, selectedIndex) {
						console.log(selectedVal)
						console.log(selectedIndex)
						var selectcarType = carType[selectedIndex].text;
						that.text(selectcarType)
						that.attr('data-cartypeId',selectedVal)
					})
				})
				$('.cartype2').on('click',function(){
					var that = $(this)
					cartypePicker2.show();
					cartypePicker2.on('picker.select', function (selectedVal, selectedIndex) {
						console.log(selectedVal)
						console.log(selectedIndex)
						var selectcarType = carType[selectedIndex].text;
						that.text(selectcarType)
						that.attr('data-cartypeId',selectedVal)
					})
				})
			}
		});
	})
	
	
	//上传当事人信息
	
	function active(){
		$('.btn').removeClass('active');
			var on = $('.btn').hasClass('active');
			if (!on) {
				$('.btn').click(function(){
					var regPhone = /^1\d{10}$/;
					var regIdcard = /^\d{15,18}$/;
					var regCarnum = /^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[A-Z]{1}[A-Z0-9]{4,5}[A-Z0-9挂学警港澳]{1}$/
					
					var cp1 = regCarnum.test($('.cpcode').val());
					var cp2 = regCarnum.test($('.cpcode1').val());
					var ph1 = regPhone.test($('.phone').val());
					var ph2 = regPhone.test($('.phone1').val());
					var idC1 = regIdcard.test($('.idcard').val());
					var idC2 = regIdcard.test($('.idcard1').val());
					
//					var regArr = [regCarnum,regCarnum,regPhone,regPhone,regIdcard,regIdcard];
					var regArr = [cp1,cp2,ph1,ph2,idC1,idC2];
					var testArr = [$('.cpcode'),$('.cpcode1'),$('.phone'),$('.phone1'),$('.idcard'),$('.idcard1')]
					
					
					if (cp1&&cp2&&ph1&&ph2&&idC1&&idC2) {
						var mine = {
							name:$('.name').val(),
							cardNo:$('.idcard').val(),
							phone:$('.phone').val(),
							carNo:$('.cpcode').val(),
							carType:$('.cartype1').attr('data-cartypeId'),
							firstpic:$('#picdrive').attr('src'),
							secondpic:$('#picrun').attr('src')
						}
						var yours = {
							name:$('.name1').val(),
							cardNo:$('.idcard1').val(),
							phone:$('.phone1').val(),
							carNo:$('.cpcode1').val(),
							carType:$('.cartype2').attr('data-cartypeId'),
							firstpic:$('#picdrive1').attr('src'),
							secondpic:$('#picrun1').attr('src')
						}
						localStorage.setItem('mine',JSON.stringify(mine));
						localStorage.setItem('yours',JSON.stringify(yours));
						localStorage.setItem('cartype1',$('.cartype1').html());
						localStorage.setItem('cartype2',$('.cartype2').html());
						window.location.href="inputmsg.html"
					}else{
						$('.alert').show();
						for (var i=0;i<6;i++) {
							if (!regArr[i]) {
								testArr[i].css('color','red');
							}else{
								testArr[i].css('color','#333');
							}
							console.log(regArr[i])
						}
						$('.sue').click(function(){
							$('.alert').hide()
						})
					}
				})
			}
		}
		$('.phone1').change(function(){
			active();
		})
	
	


		
		
		
		
	//上传证件(驾驶证)照片  1
	
	$('.mydrive').eq(0).click(function(){
		$('#bind-drive1').show();
		$('.msg-modal.drive .modal-btn a').click(function(){
			$('.msg-modal.drive').hide();
		})
		
		$('#drivecards').click(function(){
			$(this).change(function(){
				var that = $(this);
				uploadImg1(that);
				$(this).parent().siblings('.loading-cover').show();
			});
		})
	})
	
	$('.mydrive').eq(1).click(function(){
		$('#bind-drive2').show();
		$('.msg-modal.drive .modal-btn a').click(function(){
			$('.msg-modal.drive').hide();
		})
		
		$('#drivecards1').click(function(){
			$(this).change(function(){
				var that = $(this);
				uploadImg11(that);
				$(this).parent().siblings('.loading-cover').show();
			});
		})
	})

	//上传证件(行驶证)照片  2
	$('.mycar').eq(0).click(function(){
		$('#bind-car1').show();
		$('.msg-modal.drive .modal-btn a').click(function(){
			$('.msg-modal.drive').hide();
		})
		
		$('#carcards').click(function(){
			$(this).change(function(){
				var that = $(this);
				uploadImg2(that);
				$(this).parent().siblings('.loading-cover').show();
			});
		})
	})

	$('.mycar').eq(1).click(function(){
		$('#bind-car2').show();
		$('.msg-modal.drive .modal-btn a').click(function(){
			$('.msg-modal.drive').hide();
		})
		
		$('#carcards1').click(function(){
			$(this).change(function(){
				var that = $(this);
				uploadImg22(that);
				$(this).parent().siblings('.loading-cover').show();
			});
		})
	})
// 证件识别
// 驾驶证识别
	// 证件识别
	function uploadImg1(that){
		var objUrl = getObjectURL(that[0].files[0]);
    var file = that[0].files[0]; 	
		var image = new Image();
		image.src = objUrl;
			      
		image.onload = function(){
		 	var img64 = compress(image, 500, 400, 0.7);
		  
		  $.ajax({
				type:"post",
				url:base64ImgUploadUrl,
				data: {
					imgfile: img64,
					imgType: '1',
					accidentId: accidentId,
				},
		    dataType: "json",
				success: function(data){
					if(data.status == 2000){
	        	$('#picdrive').attr("src",data.list[0]);
						that.parent().css('background','none');
						$('.name').val(data.obj.name);
						$('.idcard').val(data.obj.id_card_number)
						that.parent().siblings('.loading-cover').hide();
					}else{
						$('.upload-error').show();
						setTimeout(function(){
							$('.upload-error').hide();
						},500)
				  	that.parent().siblings('.loading-cover').hide();
					}
				}
			});
		}
	}
	
	function uploadImg11(that){
		var objUrl = getObjectURL(that[0].files[0]);
    var file = that[0].files[0]; 	
		var image = new Image();
		image.src = objUrl;
			      
		image.onload = function(){
		 	var img64 = compress(image, 500, 400, 0.7);
		  
		  $.ajax({
				type:"post",
				url:base64ImgUploadUrl,
				data: {
					imgfile: img64,
					imgType: '1',
					accidentId: accidentId,
				},
		    dataType: "json",
				success: function(data){
					if(data.status == 2000){
	        	$('#picdrive1').attr("src",data.list[0]);
						that.parent().css('background','none');
						$('.name1').val(data.obj.name);
						$('.idcard1').val(data.obj.id_card_number)
						that.parent().siblings('.loading-cover').hide();
					}else{
						$('.upload-error').show();
						setTimeout(function(){
							$('.upload-error').hide();
						},500)
				  	that.parent().siblings('.loading-cover').hide();
					}
				}
			});
		}
	}
	
	function uploadImg2(that){
		var objUrl = getObjectURL(that[0].files[0]);
    var file = that[0].files[0]; 	
		var image = new Image();
		image.src = objUrl;
			      
		image.onload = function(){
		 	var img64 = compress(image, 500, 400, 0.7);
		  
		  $.ajax({
				type:"post",
				url:base64ImgUploadUrl,
				data: {
					imgfile: img64,
					accidentId: accidentId,
					imgType: '2',
				},
		    dataType: "json",
				success: function(data){
					if(data.status == 2000){
						that.parent().css('background','none');
	        	$('#picrun').attr("src",data.list[0]);
						$('.cpcode').val(data.obj.plate_no);
						$('.cartype').html(data.obj.vehicle_type)
						that.parent().siblings('.loading-cover').hide();
					}else{
						$('.upload-error').show();
						setTimeout(function(){
							$('.upload-error').hide();
						},500)
				  	that.parent().siblings('.loading-cover').hide();
					}
				}
			});
		}
	}
	
	function uploadImg22(that){
		var objUrl = getObjectURL(that[0].files[0]);
    var file = that[0].files[0]; 	
		var image = new Image();
		image.src = objUrl;
			      
		image.onload = function(){
		 	var img64 = compress(image, 500, 400, 0.7);
		  
		  $.ajax({
				type:"post",
				url:base64ImgUploadUrl,
				data: {
					imgfile: img64,
					accidentId: accidentId,
					imgType: '2',
				},
		    dataType: "json",
				success: function(data){
					if(data.status == 2000){
						that.parent().css('background','none');
	        	$('#picrun1').attr("src",data.list[0]);
						$('.cpcode1').val(data.obj.plate_no);
						$('.cartype1').html(data.obj.vehicle_type)
						that.parent().siblings('.loading-cover').hide();
					}else{
						$('.upload-error').show();
						setTimeout(function(){
							$('.upload-error').hide();
						},500)
				  	that.parent().siblings('.loading-cover').hide();
					}
				}
			});
		}
	}
	

</script>

</body>
</html>
